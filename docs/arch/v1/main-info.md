# Первичный вариант реализации архитектуры конструктора

Основой взаимодействия между сервисами является REST, workflow определяется самими сервисами

## Пользовательские сценарии

### Вызов меню UI через "/" команду бота

* Происходит отображение возможных пунктов меню, доступных клиенту

![Main menu](./img/main_menu.png)

### Создание бота совместно с созданием первого задания для напоминания

* Данный флоу вызывается через "/" команду бота;
* Отображается несколько полей для заполнения данных о новом боте;
* Отображается несколько полей для задачи нового напоминания;

![Create bot](./img/create_bot.png)

### Добавление новой нотификации для конкретного бота

* Данный флоу вызывается через "/" команду бота;
* Отображается несколько полей для получения данных о боте;
* Отображается несколько полей для задачи нового напоминания;

![Create job](./img/create_job.png)

### Получение списка текущих Job нотификаций

* Данный флоу вызывается через "/" команду бота;
* Отображается поле для получения данных о боте;
* В результате флоу выдается сообщение со списком нотификации, их кратким наименованием и статусом - активны или нет;

![Job list](./img/job_list.png)

### Изменение статуса по существующим Job-ам

* Данный флоу вызывается через "/" команду бота;
* Отображается поле для получения данных о боте;
* Отображаются поля для изменения статуса Job-а;
* В результате флоу выдается сообщение с кратким наименованием и новым статусом Job-а нотификаций;

![Change_job](./img/change_job.png)

### Изменение сообщения и расписания существующего Job-а нотификации

* Данный флоу вызывается через "/" команду бота;
* Отображается поле для получения данных о боте;
* Отображается несколько полей для редактирования напоминания;
* В результате флоу выдается сообщение с кратким наименованием и новым расписанием для Job-а;

![Change_job data](./img/change_job_data.png)

### Удаление бота

* Данный флоу вызывается через "/" команду бота;
* Отображается поле для получения данных о боте;
* В результате флоу выдается сообщение со списком нотификации, их кратким наименованием и статусом - активны или нет. А также кнопкой подтверждения об удалении джоба;
* Если клиент подтвердил действие - удаляется как бот, так и привязанные к нему Job-ы;

![Delete bot](./img/delete_bot.png)

## Общая схема взаимодействия сервисов

В рамках данного проекта можно выделить 4 сервиса, каждый из которых может отвечать за свои конкретные зоны ответственности:

* Bricklayer Constructor:
  * Назначение - сервис администрирования ботов;
  * Зона ответственности - создание, изменение, удаление ботов;
* Bricklayer Storage:
  * Назначение - сервис хранения данных ботов;
  * Зона ответственности - данные авторизации, данные для Job-ов нотификации (канал, краткое название, текст, cron);
* Bricklayer Engine:
  * Назначение - сервис реализации запуска Job-ов;
  * Зона ответственности - процесс формирования Job-ов, leader election;
* Bricklayer BFF:
  * Назначение - сервис отрисовки UI меню в Mattermost;
  * Зона ответственности - работа с "/" командами, взаимодействие с клиентом по средствам меню и диалогов.

![Arch all](./img/arch_all.png)

## Контракты взаимодействия сервисов друг с другом

### Сервис администрирования ботов

![Constructor](./img/constr_v1.png)

### Сервис хранения данных ботов

![Storage](./img/strg_v1.png)

### Сервис реализации запуска Job-ов

![Engine](./img/eng_v1.png)

### Сервис отрисовки UI меню в Mattermost

![BFF](./img/bff_v1.png)

## Диаграммы последовательности

### Создание бота совместно с созданием первого задания для напоминания

![UML](./img/create_bot_uml.png)